<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>냉장고를 부탁해 시즌 2</title>
    <style>
        .king-ingredients-grid {
            display: flex;
            flex-direction: row;
            overflow: auto;
            margin: 36px auto;
            padding: 12px;
            box-shadow: rgba(0, 0, 0, 0.66) 0px 0px 0px 1px;
            border-radius: 2px;
            scrollbar-width: thin;
            scrollbar-color: #ffffff #ffb999;
        }

        .king-ingredient-card {
            width: 100px;
            height: 100px;
            border: 1px solid #333;
            padding: 8px;
            margin: 8px;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            /* 자식 요소들이 축소되지 않도록 설정 */
        }

        .deactivation {
            background-color: #000;
            color: rgb(255, 255, 255);
        }

        /* Webkit 브라우저 (Chrome, Safari) */
        .king-ingredients-grid::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        .king-ingredients-grid::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
            box-shadow: inset 0 0 5px grey;
        }

        .king-ingredient-card>img {
            width: 70px;
            height: 70px;
        }
    </style>
</head>

<body>
    <header>
        <th:block th:insert="~{/sub/header.html}"></th:block>
    </header>
    <section>
        <div class="king-ingredients-grid" id="king-ingredient-row-list"> <!-- 재료 리스트 조회 --> 재료 불러오는 중......</div>

        <!-- 
            <div class="king-ingredients-grid">
            <div class="king-ingredient-card"><img src="/img/material/cow.png"></div>
            <div class="king-ingredient-card"><img src="/img/material/garlic.png"></div>
            <div class="king-ingredient-card"><img src="/img/material/onion.png"></div>
            <div class="king-ingredient-card"><img src="/img/material/pork.png"></div>
            <div class="king-ingredient-card"><img src="/img/material/chicken.png"></div>
            <div class="king-ingredient-card"><img src="/img/material/duck.png"></div>
            <div class="king-ingredient-card"><img src="/img/material/lamb.png"></div>
            <div class="king-ingredient-card"><img src="/img/material/tomato.png"></div>
            <div class="king-ingredient-card"><img src="/img/material/napa_cabbage.png"></div>
            <div class="king-ingredient-card"><img src="/img/material/mushroom.png"></div>
            <div class="king-ingredient-card"><img src="/img/material/turkey.png"></div>
            <div class="king-ingredient-card"><img src="/img/material/chives.png"></div>
        -->
        </div>


    </section>
    <script>
        let selections = []; // 해당 재료 리스트를 기준으로 검색
        let unselections = []; // 임시 제외된 재료 보관 리스트

        document.addEventListener("DOMContentLoaded", () => {
            getIngredients();
            cardListAddClickEvent();
        });

        /**
         * 재료 카드마다 클릭 이벤트 추가
         * 클릭 시 css active, 해당 재료 id 값 unslections 배열에 저장  
         */
        function cardListAddClickEvent() {
            document.querySelectorAll(".king-ingredient-card").forEach(card => {
                card.addEventListener("click", () => {
                    // class="deactivation" 토글
                    card.classList.toggle("deactivation");
                    const icode = parseInt(card.getAttribute("id"));

                    if (card.classList.contains("deactivation")) {
                        // selections 배열에서 제거하고 unselections 배열에 추가
                        selections = selections.filter(id => id !== icode);
                        unselections.push(icode);
                    } else {
                        // unselections 배열에서 제거하고 selections 배열에 추가
                        unselections = unselections.filter(id => id !== icode);
                        selections.push(icode);
                    }

                    console.log("선택된 항목들 : ", selections);
                    console.log("제외된 항목들 : ", unselections);
                });
            });
        }

        /**
         * 사용자의 냉장고에 등록된 재료 목록 조회
        */
        function getIngredients() {
            fetch('/menu2-api/my-ingredients')
                .then(res => res.json())
                .then(list => {
                    document.getElementById('king-ingredient-row-list').innerHTML = "";
                    list.forEach(ingredient => {
                        console.log(ingredient);

                        // 불러온 재료 카드 모양으로 추가
                        display_card(ingredient.imgUrl, ingredient.icode);

                        // selections 배열에 icode 추가
                        selections.push(ingredient.icode);
                    });
                    cardListAddClickEvent();
                })
        }

        /**
         * 재료 카드 만들기
        */
        function display_card(imgurl, icode) {

            document.getElementById('king-ingredient-row-list').innerHTML
                += '<div class="king-ingredient-card" id="' + icode
                + '"">'
                + '<img src="/img/material/' + imgurl
                // + '" id="' + icode
                + '"> </div>'
                ;
        }
    </script>
</body>

</html>