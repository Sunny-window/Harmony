<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ÎÇ†Ïî® Í∏∞Î∞ò Î©îÎâ¥ Ï∂îÏ≤ú</title>
    <style>

        .weather-container {
            margin-top: 20px;
        }
        .weather-item {
            font-size: 16px;
            display:flex;
            align-items:center;
        }
        .weather-item .weather-item-text{
        	font-size:20px;
        	padding-left:20px;
        }
        .weather-item span{
        	font-size:20px;
        	padding-left:20px;
        	font-weight:bold;
        }
        .weather-item .weather-icon{
        	display:flex;
        	align-items:center;
        }
        .weather-item .weather-icon div{
        	padding-left:10px;
        }
        .weather-item .weather-icon div p{
        	color:#777;
        	font-size:13px;
        	text-align:center;
        }
        .weather-item .weather-icon div p:last-child{
        	font-size:18px;
        }
        .weather-item .weather-icon .wicon{
        	display:inline-block;
        	font-size:40px;
        }
        .menu-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .menu-item {
            width: 210px;
            height:210px;
            overflow: hidden;
            cursor: pointer;
            position:relative;
        }
        .menu-item:hover img{
        	transform:scale(1.1);
        }
        .menu-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition:all 0.4s;
        }
        .menu-info {
        	width:100%;
        	position:absolute;
        	bottom:0;
            background:rgb(0, 0, 0, 0.6);
            text-align: center;
            padding:15px 0;
        }
        .menu-name {
        	color:#fff;
            font-weight: 400;
        }
        .menu-button {
            background-color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="weather-container" class="weather-container">
    </div>
    <div id="menu-list" class="menu-list">
    </div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const apiKey = '5ec2a8343328554022efe9f92a7fdfa3';
        const cityName = 'Busan';
        const url = `http://api.openweathermap.org/data/2.5/weather?q=${cityName}&appid=${apiKey}`;

        const weatherMapping = {
            'clear sky': 'ÎßëÏùå',
            'few clouds': 'ÎßëÏùå',
            'scattered clouds': 'ÎßëÏùå',
            'broken clouds': 'ÌùêÎ¶º',
            'overcast clouds': 'ÌùêÎ¶º',
            'light rain': 'ÎπÑ',
            'moderate rain': 'ÎπÑ',
            'heavy intensity rain': 'ÎπÑ',
            'shower rain': 'ÎπÑ',
            'rain': 'ÎπÑ',
            'thunderstorm': 'ÎπÑ',
            'snow': 'Îàà',
            'mist': 'ÏïàÍ∞ú',
            'fog': 'ÏïàÍ∞ú',
            'haze': 'ÏïàÍ∞ú',
            'smoke': 'ÏïàÍ∞ú',
            'dust': 'ÏïàÍ∞ú',
            'sand': 'ÏïàÍ∞ú',
            'ash': 'ÏïàÍ∞ú',
            'squalls': 'ÎπÑ',
            'tornado': 'ÎπÑ'
        };

        const weatherIcons = {
            'ÎßëÏùå': '‚òÄÔ∏è',
            'ÌùêÎ¶º': '‚òÅÔ∏è',
            'ÎπÑ': 'üåßÔ∏è',
            'Îàà': '‚ùÑÔ∏è',
            'ÏïàÍ∞ú': 'üå´Ô∏è'
        };

        const menuImages = {
            'ÎùºÎ©ò': 'ramen.jpg',
            'ÎèàÏπ¥Ï∏†': 'tonkatsu.png',
            'Ïß¨ÎΩï': 'jjamppong.png',
            'Îî§ÏÑ¨': 'dim_sum.png',
            'ÍπÄÏπòÏ∞åÍ∞ú': 'kimchi_stew.png',
            'ÏÜåÎ∞î': 'soba.jpg',
            'Ïä§ÌÖåÏù¥ÌÅ¨': 'steak.png',
            'ÏÇºÍ≥ÑÌÉï': 'samgyetang.png',
            'ÌïòÏù¥ÎùºÏù¥Ïä§': 'hayashi_rice.png',
            'ÏôÄÌîå': 'waffles.png',
            'ÎèôÌÉúÏ∞åÍ∞ú': 'dongtae_jjigae.png',
            'Ìò∏Î∞ïÏ£Ω': 'hobak_juk.png'
        };

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const weatherContainer = document.getElementById('weather-container');
                const date = new Date(data.dt * 1000);
                const formattedDate = date.toISOString().split('T')[0];
                const temp = (data.main.temp - 273.15).toFixed(2);
                const description = data.weather[0].description;
                const simplifiedDescription = weatherMapping[description] || 'ÎßëÏùå';
                const icon = weatherIcons[simplifiedDescription] || '‚òÄÔ∏è';

                const content = `
                    <div class="weather-item">
                        <div class="weather-icon">
                        	<p class="wicon">${icon}</p>
                        	<div>
	                        	<p>${temp}¬∞C </p>
	                        	<p>${simplifiedDescription}</p>
	                        </div>
                        </div>
                        <p class="weather-item-text">Ïù¥Îü∞ Î©îÎâ¥Îäî Ïñ¥ÎïåÏöî?</p>
                    </div>
                `;

                weatherContainer.innerHTML = content;

                // Ïò®ÎèÑÏóê Îî∞Î•∏ Î©îÎâ¥ Ï∂îÏ≤ú
                let recommendedMenus;
                if (temp < 26) {
                    recommendedMenus = ['ÎùºÎ©ò', 'ÎèàÏπ¥Ï∏†', 'Ïß¨ÎΩï', 'Îî§ÏÑ¨', 'ÏÜåÎ∞î'];
                } else if (temp >= 26 && temp < 27) {
                    recommendedMenus = ['ÍπÄÏπòÏ∞åÍ∞ú', 'ÏÜåÎ∞î', 'Ïä§ÌÖåÏù¥ÌÅ¨', 'ÏÇºÍ≥ÑÌÉï', 'ÎùºÎ©ò'];
                } else {
                    recommendedMenus = ['ÌïòÏù¥ÎùºÏù¥Ïä§', 'ÏôÄÌîå', 'ÎèôÌÉúÏ∞åÍ∞ú', 'Ìò∏Î∞ïÏ£Ω', 'ÏÜåÎ∞î'];
                }

                const menuList = document.getElementById('menu-list');
                menuList.innerHTML = recommendedMenus.map(menu => `
                    <div class="menu-item" onclick="sendMenuName(this)">
                        <img src="/uploads/${menuImages[menu] || 'default.jpg'}" alt="${menu}">
                        <div class="menu-info">
                            <div class="menu-name">${menu}</div>
                        </div>
                    </div>
                `).join('');
            })
            .catch(error => console.error('Error fetching weather data:', error));
    });

    function sendMenuName(element) {
        const menuName = element.querySelector('.menu-name').textContent;
        window.location.href = `/menu_all/recipe_list_name?menuName=${encodeURIComponent(menuName)}`;
    }
</script>
</body>
</html>