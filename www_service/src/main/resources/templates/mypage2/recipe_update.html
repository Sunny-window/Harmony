<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>레시피 수정</title>
<link rel="stylesheet" as="style" crossorigin
	href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" />
<style>
section {
	padding-top: 30px !important;
	padding-bottom: 100px !important;
}

.queen-page-title {
	margin: 50px 0;
	text-align: center;
	font-weight: 500;
}

.choice-menu-img {
	width: 500px;
	margin: 0 auto;
	height: 300px;
	border: 1px solid #eee;
	border-radius: 10px;
	background: #fff;
	overflow: hidden;
}

.choice-menu-img img {
	width: 100%;
	height: 100%;
	object-fit: cover;
}

.choice-menu-name {
	text-align: center;
	margin: 40px 0;
}

.recipe-regist-box1 {
	width: 100%;
	margin: 30px auto;
	background: rgb(190, 227, 241, 0.1);
	border: 1px solid #bee3f1;
	border-radius: 5px;
	padding: 30px 0;
}

.recipe-regist-box1 table {
	margin: 0 auto;
	border-spacing: 30px 30px;
}

.recipe-regist-box1 table th {
	text-align: left;
	font-weight: 500;
	font-size: 16px;
}

.recipe-regist-box1 input[type="text"] {
	font-family: "Pretendard Variable", Pretendard;
	width: 600px;
	height: 50px;
	border: 1px solid #ececec;
	background: #fff;
	box-sizing: border-box;
	border-radius: 5px;
	padding-left: 10px;
	color: #666;
}

.recipe-regist-box1 select {
	font-family: "Pretendard Variable", Pretendard;
	width: 120px;
	height: 50px;
	border: 1px solid #ececec;
	border-radius: 5px;
	padding: 0 10px;
}

.recipe-regist-box2 {
	width: 100%;
	margin: 30px auto;
	background: rgb(190, 227, 241, 0.1);
	border: 1px solid #bee3f1;
	padding: 30px 0;
	border-radius: 5px;
}

.recipe-regist-box2 table {
	margin: 0 auto;
	border-spacing: 20px 30px;
}

.recipe-regist-box2 table th {
	text-align: left;
	font-weight: 500;
	font-size: 16px;
}

.recipe-regist-box2 select {
	font-family: "Pretendard Variable", Pretendard;
	width: 150px;
	height: 50px;
	border: 1px solid #ececec;
	border-radius: 5px;
	padding: 0 10px;
}

.recipe-regist-box2 input[type="text"] {
	font-family: "Pretendard Variable", Pretendard;
	width: 160px;
	height: 50px;
	border: 1px solid #ececec;
	border-radius: 5px;
	box-sizing: border-box;
	padding-left: 10px;
}

.recipe-regist-box2 input[name="amount"] {
	width: 100px;
}

.recipe-regist-box2 .addBtn {
	text-align: center;
}

.recipe-regist-box2 .addBtn img {
	display: inline-block;
	cursor: pointer;
}

.recipe-regist-box2 .ingredient-delete-btn {
	font-size: 16px;
	font-weight: 500;
	cursor: pointer;
	padding: 2px 7px;
	border: 2px solid #F5A47D;
	color: #F5A47D;
	border-radius: 50%;
}

.recipe-regist-box3 {
	width: 100%;
	margin: 30px auto;
	background: rgb(190, 227, 241, 0.1);
	border: 1px solid #bee3f1;
	padding: 30px 0;
	border-radius: 5px;
}

.recipe-regist-box3 h4 {
	padding-left: 155px;
	font-weight: 500;
}

.recipe-regist-box3 table {
	margin: 0 auto;
	border-spacing: 20px 30px;
}

.recipe-regist-box3 table th {
	font-size: 20px;
	font-weight: 400;
	text-align: left;
}

.recipe-regist-box3 textarea {
	font-family: "Pretendard Variable", Pretendard;
	width: 410px;
	height: 100px;
	resize: none;
	border: 1px solid #ececec;
	border-radius: 5px;
	padding: 10px;
	box-sizing: border-box;
}

.recipe-regist-box3 .order-img-text {
	font-size: 20px;
	text-align: center;
}

.recipe-regist-box3 .order-img {
	width: 160px;
	height: 100px;
	border: 1px solid #eee;
	border-radius: 5px;
	overflow: hidden;
	cursor: pointer;
	background: #fff;
}

.recipe-regist-box3 .order-img img {
	width: 100%;
	height: 100%;
	object-fit: cover;
}

.recipe-regist-box3 .addBtn {
	text-align: center;
}

.recipe-regist-box3 .addBtn img {
	display: inline-block;
	cursor: pointer;
}

.recipe-regist-box3 .delete-btn {
	font-size: 16px;
	font-weight: 500;
	cursor: pointer;
	padding: 2px 7px;
	border: 2px solid #F5A47D;
	color: #F5A47D;
	border-radius: 50%;
}

.recipe-regist-box4 {
	width: 100%;
	margin: 30px auto;
	background: rgb(190, 227, 241, 0.1);
	border: 1px solid #bee3f1;
	padding: 30px 0;
	border-radius: 5px;
}

.recipe-regist-box4 table {
	margin: 0 auto;
	border-spacing: 20px 30px;
}

.recipe-regist-box4 table th {
	text-align: left;
	font-weight: 500;
	font-size: 16px;
	text-align: left;
}

.recipe-regist-box4 input[type="text"] {
	font-family: "Pretendard Variable", Pretendard;
	width: 600px;
	height: 50px;
	border: 1px solid #ececec;
	border-radius: 5px;
	box-sizing: border-box;
	padding-left: 10px;
}

.recipe-regist-btns {
	text-align: center;
}

.recipe-regist-btns input[type="submit"] {
	font-family: "Pretendard Variable", Pretendard;
	width: 133px;
	background: #F5A47D;
	border: 1px solid #F5A47D;
	border-radius: 5px;
	color: #fff;
	cursor: pointer;
	padding: 12px 0;
	font-size: 14px;
	box-sizing: border-box;
}

.recipe-regist-btns a {
	display: inline-block;
	width: 133px;
	background: #fff;
	border: 1px solid #F5A47D;
	border-radius: 5px;
	color: #F5A47D;
	cursor: pointer;
	padding: 12px 0;
	font-size: 14px;
	box-sizing: border-box;
}

.recipe-menu-list {
	margin: 20px 0;
}

.recipe-menu-list ul {
	width: 100%;
	display: flex;
	flex-wrap: wrap;
	gap: 10px;
	border: 1px solid #DAC0DE;
	padding: 40px;
	box-sizing: border-box;
	border-radius: 5px;
}

.recipe-menu-list ul li {
	text-align: center;
	padding: 10px;
	cursor: pointer;
}

.recipe-menu-list ul li:hover {
	background: #DAC0DE;
	border-radius: 5px;
}

.selected {
	background: #DAC0DE;
	border-radius: 5px;
}
</style>
</head>
<body>
	<header>
		<th:block th:insert="~{/sub/header.html}"></th:block>
	</header>
	<section>

		<h1 class="queen-page-title">레시피 수정</h1>
		<div class="choice-menu-img">
			<img id="menu-image" src=""
				onerror="this.onerror=null; this.src='/img/imgNone2.png';">
		</div>

		<!-- 레시피를 등록할 메뉴 전체 리스트 -->
		<div class="choice-menu-name">
			<h4>메뉴 선택</h4>
			<div class="recipe-menu-list">
				<ul>
					<th:block th:each="menu : ${list}">
						<li id="recipe-menu-name" th:text="${menu.menuName}"
							th:attr="mcode=${menu.mcode}"
							th:class="${menu.mcode == recipe.mcode ? 'selected' : ''}">
						</li>
					</th:block>
				</ul>
			</div>
		</div>

		<!-- 레시피 수정 폼 -->
		<form id="recipeForm" action="/my/recipe/update" method="post"
			enctype="multipart/form-data">
			<input type="hidden" name="mcode" id="current-mcode"
				th:value="${recipe.mcode}"> <input type="hidden"
				name="rcode" th:value="${recipe.rcode}">
			<div class="recipe-regist-box1">
				<table>
					<tr>
						<th>레시피 제목</th>
						<td><input type="text" name="recipeName"
							th:value="${recipe.recipeName}" required></td>
					</tr>
					<tr>
						<th>요리 소개</th>
						<td><input type="text" name="introduce"
							th:value="${recipe.introduce}" required></td>
					</tr>
					<tr>
						<th>동영상 주소</th>
						<td><input type="text" name="url" th:value="${recipe.url}"
							required></td>
					</tr>
					<tr>
						<th>카테고리</th>
						<td><select name="category" id="category-sel" required>
								<option value="">카테고리별</option>
								<option value="국/탕" th:selected="${recipe.category == '국/탕'}">국/탕</option>
								<option value="찜/조림" th:selected="${recipe.category == '찜/조림'}">찜/조림</option>
								<option value="구이" th:selected="${recipe.category == '구이'}">구이</option>
								<option value="찌개/전골"
									th:selected="${recipe.category == '찌개/전골'}">찌개/전골</option>
								<option value="볶음" th:selected="${recipe.category == '볶음'}">볶음</option>
								<option value="디저트" th:selected="${recipe.category == '디저트'}">디저트</option>
								<option value="밥요리" th:selected="${recipe.category == '밥요리'}">밥요리</option>
								<option value="면요리" th:selected="${recipe.category == '면요리'}">면요리</option>
								<option value="튀김" th:selected="${recipe.category == '튀김'}">튀김</option>
								<option value="기타" th:selected="${recipe.category == '기타'}">기타</option>
						</select></td>
					</tr>
					<tr>
						<th>테마</th>
						<td><select name="theme" id="theme-sel" required>
								<option value="">테마별</option>
								<option value="한식" th:selected="${recipe.theme == '한식'}">한식</option>
								<option value="중식" th:selected="${recipe.theme == '중식'}">중식</option>
								<option value="일식" th:selected="${recipe.theme == '일식'}">일식</option>
								<option value="양식" th:selected="${recipe.theme == '양식'}">양식</option>
								<option value="분식" th:selected="${recipe.theme == '분식'}">분식</option>
								<option value="야식/안주" th:selected="${recipe.theme == '야식/안주'}">야식/안주</option>
								<option value="생일/기념일" th:selected="${recipe.theme == '생일/기념일'}">생일/기념일</option>
								<option value="다이어트" th:selected="${recipe.theme == '다이어트'}">다이어트</option>
								<option value="파티" th:selected="${recipe.theme == '파티'}">파티</option>
								<option value="손님상" th:selected="${recipe.theme == '손님상'}">손님상</option>
								<option value="아이반찬" th:selected="${recipe.theme == '아이반찬'}">아이반찬</option>
								<option value="캠핑/피크닉" th:selected="${recipe.theme == '캠핑/피크닉'}">캠핑/피크닉</option>
								<option value="명절" th:selected="${recipe.theme == '명절'}">명절</option>
								<option value="기타" th:selected="${recipe.theme == '기타'}">기타</option>
						</select></td>
					</tr>
					<tr>
						<th>인원</th>
						<td><select name="portions" id="portions-sel" required>
								<option value="0">인원 선택</option>
								<option value="1">1인</option>
								<option value="2">2인</option>
								<option value="3">3인 이상</option>
						</select></td>
					</tr>
				</table>
			</div>

			<div class="recipe-regist-box2">
				<table id="ingredient-table">
					<th:block th:each="ingre, i : ${recipeIngredient}">
						<tr>
							<th>재료 정보</th>
							<td><select name="icode"
								th:id="'ingredient-select-' + ${i.index}" required>
									<option value="0">재료 이름</option>
							</select></td>
							<td><input type="text" name="state"
								placeholder="재료상태 예) 간거, 온거" th:value="${ingre.state}">
							</td>
							<td><input type="text" name="amount" placeholder="수량"
								th:value="${ingre.amount}" required></td>
							<td><input type="text" name="type" placeholder="단위(개/g)"
								th:value="${ingre.type}" required></td>
							<td><span class="ingredient-delete-btn">X</span></td>
						</tr>
				</table>
				</th:block>
				<div class="addBtn">
					<img src="/img/addBtn.png" id="recipe-ingredient-add">
				</div>
			</div>

			<div class="recipe-regist-box3">
				<h4>요리 순서</h4>
				<table id="recipe-steps">
					<th:block th:each="order, i : ${recipeOrder}">
						<tr>
							<th>Step [[${i.index + 1}]] <input type="hidden"
								name="orderNum" th:value="${i.index + 1}" required>
							</th>
							<td><textarea name="orderContent"
									placeholder="예) 파를 송송 썰어주세요" th:text="${order.orderContent}"></textarea></td>
							<td class="order-img">
								<p class="order-img-text"
									th:style="${order.cookingImg != null && !order.cookingImg.isEmpty() ? 'display:none;' : ''}">➕</p>
								<input type="file" name="newCookingImg" accept="image/*"
								style="display: none;"> <input type="hidden"
								name="existingCookingImg" th:value="${order.cookingImg}">
								<img
								th:src="@{${order.cookingImg != null && !order.cookingImg.isEmpty() ? '/uploads/' + order.cookingImg : '/img/imgNone.png'}}"
								th:style="${order.cookingImg != null && !order.cookingImg.isEmpty() ? '' : 'display:none;'}">
							</td>
							<td><span class="delete-btn">X</span></td>
						</tr>
					</th:block>

				</table>
				<div class="addBtn">
					<img src="/img/addBtn.png" id="recipe-order-add">
				</div>
			</div>

			<div class="recipe-regist-box4">
				<table>
					<tr>
						<th>태그</th>
						<td><input type="text" name="tagContent"
							placeholder="예) 한식, 닭볶음탕"
							th:value="${recipeTag != null ? recipeTag.tagContent : ''}">
						</td>
					</tr>
				</table>
			</div>

			<div class="recipe-regist-btns">
				<input type="submit" value="수정"> <a
					th:href="@{/my/recipe/list(mno=${mno})}">취소</a>
			</div>
		</form>
	</section>

	<footer>
		<th:block th:insert="~{/sub/footer.html}"></th:block>
	</footer>


	<script th:inline="javascript">
	
	<!-- Thymeleaf를 통해 서버에서 전달된 데이터를 JavaScript 변수에 할당 -->
	const ingredientsList = /*[[${ingredientList}]]*/ [];
	var initialIngredients = /*[[${recipeIngredient}]]*/ [];
    let selectIdCounter = 1;

	// 페이지 로드 시 초기화 함수 실행
document.addEventListener("DOMContentLoaded", async function(){
    await initializeApp();
});

	// 앱 초기화 함수
async function initializeApp() {
    loadInitialData();
    setupEventListeners();
    highlightSelectedMenu();
    await getIngredients();
    applyInitialIngredients();
}

//재료 정보를 서버에서 가져오는 함수
function getIngredients() {
    return new Promise((resolve, reject) => {
        const selects = document.querySelectorAll('select[name="icode"]');
        
        fetch('/api/ingredients')
            .then(response => response.json())
            .then(ingredients => {
                console.log("Loaded ingredients:", ingredients);
             // 각 select 요소에 재료 옵션 추가
                selects.forEach((select) => {
                    const selectedValue = select.value; // 현재 선택된 값을 저장
                    ingredients.forEach(ingredient => {
                        if (!select.querySelector(`option[value="${ingredient.icode}"]`)) {
                            const option = document.createElement('option');
                            option.value = ingredient.icode;
                            option.textContent = ingredient.name;
                            if (ingredient.icode == selectedValue) {
                                option.selected = true;
                            }
                            select.appendChild(option);
                        }
                    });
                });
                resolve(ingredients);
            })
            .catch(error => {
                console.error('Error loading ingredients:', error);
                reject(error);
            });
    });
}

//초기 재료 정보 적용 함수
function applyInitialIngredients() {
    initialIngredients.forEach((ingre, index) => {
        const select = document.getElementById(`ingredient-select-${index}`);
        if (select) {
            const option = select.querySelector(`option[value="${ingre.icode}"]`);
            if (option) {
                option.selected = true;
            } else {
                console.warn(`Option with value ${ingre.icode} not found for ingredient ${index}`);
            }
        } else {
            console.warn(`Select element not found for ingredient ${index}`);
        }
    });
}

//선택된 메뉴 하이라이트 함수
function highlightSelectedMenu() {
    const currentMcode = document.getElementById("current-mcode").value;
    const currentMenuItem = document.querySelector(`li[mcode="${currentMcode}"]`);
    if (currentMenuItem) {
        currentMenuItem.classList.add("selected");
    }
}

//초기 데이터 로드 함수
function loadInitialData() {
	// 카테고리, 인분, 테마 정보 설정
	const categorySel = document.getElementById("category-sel");
    const portionsSel = document.getElementById("portions-sel");
    const themeSel = document.getElementById("theme-sel");
    
 	// Thymeleaf를 통해 서버에서 전달받은 데이터 사용
    const recipeCategory = /*[[${recipe.category}]]*/ '';
    const recipePortions = /*[[${recipe.portions}]]*/ '';
    const recipeTheme = /*[[${recipe.theme}]]*/ '';
    
    if (categorySel && recipeCategory) {
        categorySel.value = recipeCategory;
    }
    
    if (portionsSel && recipePortions) {
        portionsSel.value = recipePortions;
    }
    
    if (themeSel && recipeTheme) {
        themeSel.value = recipeTheme;
    }
    
    console.log("Category:", recipeCategory); // 디버깅을 위한 로그
    console.log("Portions:", recipePortions); // 디버깅을 위한 로그
    console.log("Theme:", recipeTheme); // 디버깅을 위한 로그
    
    updateMenuImage(document.getElementById("current-mcode").value);
    setupOrderImages();
}

//이벤트 리스너 설정 함수
function setupEventListeners() {
	// 메뉴 클릭 이벤트
    document.querySelectorAll('#recipe-menu-name').forEach(menuItem => {
        menuItem.addEventListener("click", handleMenuClick);
    });

 	// 재료 테이블 이벤트
    document.getElementById('ingredient-table').addEventListener('change', handleIngredientChange);
    document.getElementById('ingredient-table').addEventListener('click', handleIngredientDelete);

 	// 재료 및 레시피 순서 추가 버튼 이벤트
    document.getElementById('recipe-ingredient-add').addEventListener('click', addIngredient);
    document.getElementById('recipe-order-add').addEventListener('click', addRecipeOrder);

 	// 레시피 단계 관련 이벤트
    document.getElementById('recipe-steps').addEventListener('click', handleRecipeStepEvents);
}

//메뉴 클릭 핸들러
function handleMenuClick(event) {
    updateSelectedMenu(event.target);
    const mcode = event.target.getAttribute("mcode");
    updateMenuImage(mcode);
    document.getElementById("current-mcode").value = mcode;
}

//선택된 메뉴 업데이트 함수
function updateSelectedMenu(menuItem) {
	const prevSelected = document.querySelector('li.selected');
    if (prevSelected) {
        prevSelected.classList.remove("selected");
    }
    menuItem.classList.add("selected");
}

//메뉴 이미지 업데이트 함수
function updateMenuImage(mcode) {
    fetch(`/api/getMenuImage?mcode=${mcode}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            if (data && data.imgurl) {
                const imageUrl = `/uploads/${data.imgurl}`;
                const menuImage = document.getElementById("menu-image");
                menuImage.src = imageUrl;
                menuImage.onerror = () => { 
                    menuImage.src = '/img/imgNone2.png';
                    console.warn(`Failed to load image for mcode: ${mcode}`);
                };
            } else {
                throw new Error('Image URL is undefined');
            }
        })
        .catch(error => {
            console.error('Error updating menu image:', error);
            document.getElementById("menu-image").src = '/img/imgNone2.png';
        });
}

//재료 변경 핸들러
function handleIngredientChange(event) {
    if (event.target.matches("select[name='icode']")) {
        updateIngredientType(event.target);
    }
}

//재료 삭제 핸들러
function handleIngredientDelete(event) {
    if (event.target.matches('.ingredient-delete-btn')) {
        event.target.closest('tr').remove();
    }
}

//재료 추가 함수
function addIngredient() {
    const table = document.getElementById('ingredient-table');
    const newRow = createIngredientRow();
    table.appendChild(newRow);
}

//레시피 단계 이벤트 핸들러
function handleRecipeStepEvents(event) {
    if (event.target.matches('.order-img')) {
        handleImageUpload(event.target);
    } else if (event.target.matches('.delete-btn')) {
        handleStepDelete(event.target);
    }
}

//이미지 업로드 핸들러
function handleImageUpload(orderImgCell) {
    const imageInput = orderImgCell.querySelector('input[type="file"]');
    const imageDisplay = orderImgCell.querySelector('img');
    const imageInText = orderImgCell.querySelector(".order-img-text");
    
    // 이미지와 텍스트 모두에 클릭 이벤트 추가
    orderImgCell.addEventListener('click', function(e) {
        if (e.target === this || e.target === imageInText || e.target === imageDisplay) {
            imageInput.click();
        }
    });
    
 // 파일 선택 시 이미지 미리보기
    imageInput.addEventListener('change', function() {
        if (this.files && this.files[0]) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                imageDisplay.src = e.target.result;
                imageDisplay.style.display = 'block';
                imageInText.style.display = 'none';
            };
            
            reader.readAsDataURL(this.files[0]);
        }
    });
}

//레시피 단계 삭제 핸들러
function handleStepDelete(deleteBtn) {
    deleteBtn.closest('tr').remove();
    updateStepNumbers();
}

//레시피 순서 추가 함수
function addRecipeOrder() {
    const table = document.getElementById("recipe-steps");
    const stepNumber = table.rows.length + 1;
    const newRow = createRecipeOrderRow(stepNumber);
    table.appendChild(newRow);
    handleImageUpload(newRow.querySelector('.order-img'));
    updateStepNumbers();
}

//요리순서 추가버튼 클릭시 HTML 구조생성
function createRecipeOrderRow(stepNumber, existingImageUrl = '') {
    const newRow = document.createElement('tr');
    newRow.innerHTML = `
        <th>Step ${stepNumber}
            <input type="hidden" name="orderNum" value="${stepNumber}">
        </th>
        <td>
            <textarea name="orderContent[${stepNumber - 1}]"></textarea>
        </td>
        <td class="order-img">
            <p class="order-img-text" ${existingImageUrl ? 'style="display:none;"' : ''}>➕</p>
            <input type="file" name="newCookingImg[${stepNumber - 1}]" accept="image/*" style="display:none;">
            <input type="hidden" name="existingCookingImg[${stepNumber - 1}]" value="${existingImageUrl}">
            <img src="${existingImageUrl || '/img/imgNone.png'}" style="${existingImageUrl ? '' : 'display:none;'}">
        </td>
        <td>
            <span class="delete-btn">X</span>
        </td>
    `;
    return newRow;
}

//레시피 단계 번호 업데이트 함수
function updateStepNumbers() {
    const rows = document.querySelectorAll('#recipe-steps tr');
    rows.forEach((row, index) => {
        const stepNum = index + 1;
        const stepCell = row.querySelector('th');
        const orderNumInput = stepCell.querySelector('input[name="orderNum"]');
        const textArea = row.querySelector('textarea');
        const fileInput = row.querySelector('input[type="file"]');
        
        stepCell.firstChild.textContent = `Step ${stepNum}`;
        orderNumInput.value = stepNum;
        textArea.name = `orderContent[${index}]`;
        if (fileInput) {
            fileInput.name = `cookingImg[${index}]`;
        }
    });
}

//레시피 요리순서 이미지 설정 함수
function setupOrderImages() {
    document.querySelectorAll('.order-img').forEach((cell, index) => {
    	// 동적으로 이미지 표시 여부 결정
        const img = cell.querySelector('img');
        const textElem = cell.querySelector('.order-img-text');
        const fileInput = cell.querySelector('input[type="file"]');
        
        if (img.src && !img.src.endsWith('imgNone.png')) {
            textElem.style.display = 'none';
            img.style.display = 'block';
        } else {
            textElem.style.display = 'block';
            img.style.display = 'none';
        }

        fileInput.name = `cookingImg[${index}]`;
        handleImageUpload(cell);
    });
}

// 재료정보 추가버튼 클릭시 HTML 구조생성
function createIngredientRow() {
	// tr 요소를 생성해 변수에 담기
    const newRow = document.createElement('tr');
	// 생성된 tr 안에 재료정보와 같은 HTML 추가
    newRow.innerHTML = `
        <th>재료 정보</th>
        <td>
            <select name="icode" id="ingredient-select-${selectIdCounter++}">
                <option value="0">재료 이름</option>
                // map메서드를 이용해 ingredientsList의 각 재료들을 각각 option태그의 문자열로 변환
                ${ingredientsList.map(ingredient =>
                    `<option value="${ingredient.icode}">${ingredient.name}</option>`
                ).join('')} // join메서드를 이용해 map으로 생성된 배열을 연속된 하나의 문자열로 변환
            </select>
        </td>
        <td><input type="text" name="state" placeholder="재료상태 예) 간거, 온거"></td>
        <td><input type="text" name="amount" placeholder="수량"></td>
        <td><input type="text" name="type" placeholder="단위(개/g/스푼/포기 등)"></td>
        <td><span class="ingredient-delete-btn">X</span></td>
    `;
    // 생성된 tr요소를 return으로 반환
    return newRow;
}


//폼 제출 이벤트 리스너
document.getElementById('recipeForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const mcodeInput = document.getElementById('current-mcode');
    const menuSelectionArea = document.querySelector('.choice-menu-name');
    
    if (!mcodeInput.value) {
        alert('메뉴를 선택해주세요.');
        menuSelectionArea.style.border = '2px solid red';
        menuSelectionArea.scrollIntoView({ behavior: 'smooth' });
        setTimeout(() => {
            menuSelectionArea.style.border = '';
        }, 3000);
    } else {
        console.log("Form data:", new FormData(this));
        this.submit();
    }
});

</script>

</body>
</html>